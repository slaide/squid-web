<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Native Page</title>
        <style>
            *{
                margin:0;
                border:0;
                padding:0;
                font-family:Arial;
            }
            input{
                width:auto;
                height:1.5em;
            }
            label,button,select{
                user-select: none;
            }
            select,button,input{
                cursor:pointer;
            }
            input[type=text],input[type=number]{
                cursor:text;
            }
            button:hover{
                background-color:rgb(175, 175, 175);
            }
            img{
                image-rendering: pixelated;
            }
            li{
                margin-left:1.5em;
            }
        </style>
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
        <script src="components/p/init.js"></script>
    </head>
    <body>
        <style>
            #bigblank{
                height:100vh;
                width:100vw;
                position:absolute;
                top:0;
                left:0;
                z-index:100;
                background-color:lightgrey;
            }
            #bigblank.inactive{
                display:none;
            }
            #bigblank > div{
                position:absolute;
                top:50%;
                left:50%;
                transform:translate(-50%,-50%);

                font-size: 5em;
            }
        </style>
        <div id="bigblank">
            <div>
                LOADING
            </div>
        </div>

        <style>
            #main-content{
                width:100vw;
                height:100vh;
                overflow: hidden;
            }
        </style>
        <div id="main-content" class="tab-container" >
            <style>
                #basic-setup-tab:not(.inactive){
                    display:grid;
                    grid-template-columns: auto auto;
                }
            </style>
            <div class="tab-body" tab-name="basic setup" id="basic-setup-tab">
                <label>camera trigger</label>
                <script>
                    p.init_camera_trigger_dropdown=function(element){
                        const camera_triggers=[
                            {
                                'name':'Hardware',
                                'handle':'hardware'
                            },
                            {
                                'name':'Software',
                                'handle':'software'
                            }
                        ]

                        p.create_dropdown(element,camera_triggers)
                    }
                </script>
                <select class="data" p:init="init_camera_trigger_dropdown"></select>

                <label>pixel depth</label>
                <script>
                    p.init_pixel_depth_dropdown=function(element){
                        const pixel_depths=[
                            {
                                'name':'8 Bit (Mono)',
                                'handle':'mono8'
                            },
                            {
                                'name':'12 Bit (Mono)',
                                'handle':'mono12'
                            }
                        ]

                        p.create_dropdown(element,pixel_depths)
                    }
                </script>
                <select class="data" p:init="init_pixel_depth_dropdown"></select>

                <label>base path</label>
                <script>
                    p.set_base_path=function(event){
                        let event_target=event.target
                        let value=event_target.value

                        this.config.base_path=value
                    }
                </script>
                <input type="text" placeholder="Please enter the Base Path" class="data" p:on-input="set_base_path"/>

                <label>project name</label>
                <script>
                    p.set_project_name=function(event){
                        let event_target=event.target
                        let value=event_target.value

                        this.config.project_name=value
                    }
                </script>
                <input type="text" placeholder="Please enter the Project Name" class="data" p:on-input="set_project_name"/>
                <label>plate name</label>
                <script>
                    p.set_plate_name=function(event){
                        let event_target=event.target
                        let value=event_target.value

                        this.config.plate_name=value
                    }
                </script>
                <input type="text" placeholder="Please enter the Plate Name" class="data" p:on-input="set_plate_name"/>
                <label>cell line</label>
                <script>
                    p.set_cell_line=function(event){
                        let event_target=event.target
                        let value=event_target.value

                        this.config.cell_line=value
                    }
                </script>
                <input type="text" placeholder="Please enter the Cell Line" class="data" p:on-input="set_cell_line"/>

                <label>image format</label>
                <script>
                    p.init_image_format_dropdown=function(element){
                        const image_formats=[
                            {
                                'name':'TIFF',
                                'handle':'tiff'
                            },
                            {
                                'name':'TIFF (compressed)',
                                'handle':'tiffcompressed'
                            }
                        ]
                        p.create_dropdown(element,image_formats)
                    }
                </script>
                <select class="data" p:init="init_image_format_dropdown"></select>

                <label>plate type</label>
                <script>
                    p.init_plate_type_dropdown=function(element){
                        const plate_types=[
                            {
                                'name':'Generic 96',
                                'handle':'ge96',
                                'well_count':96,
                                'well_count_x':12,
                                'well_count_y':8
                            },
                            {
                                'name':'Generic 384',
                                'handle':'ge384',
                                'well_count':384,
                                'well_count_x':24,
                                'well_count_y':16
                            }
                        ]
                        p.create_dropdown(element,plate_types)
                    }
                </script>
                <select class="data" p:init="init_plate_type_dropdown"></select>

                <label>objective</label>
                <script>
                    p.init_objective_dropdown=function(element){
                        const objectives=[
                            {
                                'name':'4x (Olympus)',
                                'handle':'olympus4x'
                            },
                            {
                                'name':'10x (Olympus)',
                                'handle':'olympus10x'
                            },
                            {
                                'name':'20x (Olympus)',
                                'handle':'olympus20x'
                            }
                        ]
                        p.create_dropdown(element,objectives)
                    }
                </script>
                <select class="data" p:init="init_objective_dropdown"></select>

                <button>Load Settings</button>
            </div>

            <div class="tab-body" tab-name="well selection + grid" id="live-view-bodys">
                <style>
                    #well-selection-container{
                        background-color:red;
                        width:100%;
                        height:100%;
                        display:grid;

                        grid-template-columns: repeat(var(--num-columns), 1fr);
                        grid-template-rows: repeat(var(--num-rows), 1fr);
                    }
                </style>
                <script>
                    p.init_well_selection=function(element){
                        let container_width=element.clientWidth
                        let container_height=element.clientHeight

                        let well_count_x=12
                        let well_count_y=8

                        element.style.setProperty("--num-columns",well_count_x)
                        element.style.setProperty("--num-rows",well_count_y)

                        let well_width=container_width/well_count_x
                        let well_height=container_height/well_count_y

                        let well_size=Math.min(well_width,well_height)

                        for(let x=0;x<well_count_x;x++){
                            for(let y=0;y<well_count_y;y++){
                                let well=document.createElement("div")
                                well.style.width=well_size+"px"
                                well.style.height=well_size+"px"
                                well.style.border="1px solid black"
                                element.appendChild(well)
                            }
                        }
                    }
                </script>
                <div id="well-selection-container" class="data" p:init-vis="init_well_selection"></div>
            </div>

            <style>
                #channel-focus-setup:not(.inactive){
                    display:grid;
                    grid-template-columns: 1fr 2fr;
                    height:100%;
                    overflow:hidden;
                }
                #channel-container{
                    display:grid;
                    grid-template-columns: 1fr;
                    grid-template-rows: repeat(100,min-content);

                    overflow-y: scroll;
                }
            </style>
            <div class="tab-body" tab-name="channel + focus setup" id="channel-focus-setup">
                <script>
                    p.add_channel_config_item=function(event){
                        let channel_config_item_template=p.templates["channel_config_item"]
                        let channel_config_item=channel_config_item_template.content.cloneNode(true)

                        let channel_container=event.target.parentNode
                        channel_container.insertBefore(channel_config_item,event.target)
                    }
                    p.init_lightsource_dropdown=function(element){
                        const light_sources=[
                            {
                                'name':'Laser 405nm',
                                'handle':'laser405nm'
                            },
                            {
                                'name':'Laser 488nm',
                                'handle':'laser488nm'
                            },
                            {
                                'name':'Laser 730nm',
                                'handle':'laser730nm'
                            }
                        ]
                        p.create_dropdown(element,light_sources)
                    }
                </script>
                <style>
                    .channel-config-item{
                        display:grid;
                        grid-template-columns: 1fr 1fr;
                        border-bottom: 1px solid black;
                        padding-bottom: 0.5em;
                        margin-bottom: 0.2em;
                    }
                    .channel-config-item-name{
                        font-size: 1.5em;
                        font-weight: bold;
                        grid-column: 1 / span 2;
                    }
                    .channel-config-add-item-button{
                        height:1.5em;
                        font-size:1.3em;
                        padding:0.5;
                        margin:0.2em;
                        margin-top: 1em;
                        border:1px solid black;
                    }
                </style>
                <div id="channel-container" class="data">
                    <template name="channel_config_item">
                        <div class="channel-config-item">
                            <input class="channel-config-item-name" type="text" placeholder="Enter Channel Name"/>

                            <label>Lightsource</label>
                            <select class="data" p:init="init_lightsource_dropdown"></select>

                            <label>Illumination (%)</label>
                            <input type="number" min="0" max="100" step="0.1" value="100" wheel-adjust="false"/>
                            <label>Exposure time (ms)</label>
                            <input type="number" min="0.1" max="936" step="0.1" value="10" wheel-adjust="false"/>
                            <label>Analog Gain</label>
                            <input type="number" min="0" max="24" step="0.1" value="0" wheel-adjust="false"/>
                            <label>Z-Offset? (um)</label>
                            <input type="number" min="-300" max="300" step="0.1" value="0" wheel-adjust="false"/>

                            <button class="">whatever</button>
                        </div>
                    </template>
                    <button class="data channel-config-add-item-button" p:on-click="add_channel_config_item">add a channel</button>
                </div>
                <div>
                    channel setup goes here
                    <ul>
                        <li>live view</li>
                        <li>contrast and brightness enhancers</li>
                        <li>overlay to indicate saturated pixels?</li>
                        <li>histogram</li>
                        <li>focus measure?</li>
                    </ul>
                </div>
            </div>

            <div class="tab-body" tab-name="review" id="whatasdverasd">
            </div>

            <div class="tab-body" tab-name="run" id="whaasdastverasd">
            </div>
        </div>

        <div id="element_containing_external_links" style="display:none;">
            <link rel="stylesheet" href="components/tab/style.css">
            <script src="components/tab/logic.js"></script>

            <link rel="stylesheet" href="components/dynamic-image/style.css">
            <script src="components/dynamic-image/logic.js"></script>

            <!-- loading page done - deactive loading screen overlay-->
            <script>
                let mutation_observer=new MutationObserver((mutations)=>{
                    mutations.forEach((mutation)=>{
                        if(mutation.type=="childList"){
                            if(mutation.addedNodes.length>0){
                                console.log("added something to the dom")
                            }
                            for(let node of mutation.addedNodes){
                                p.init(node,true)
                            }
                        }
                    })
                })
                mutation_observer.observe(document.body,{attributes:false,childList:true,characterData:false,subtree:true})

                setTimeout(function(){
                    document.getElementById("bigblank").classList.add("inactive")
                },300)
            </script>
        </div>
    </body>
</html>